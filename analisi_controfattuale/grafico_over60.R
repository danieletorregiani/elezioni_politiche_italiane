rm(list = ls())

library(ggplot2)
library(tidyr)
library(ggthemes)

### 2018 ###

# Dati delle colonne
data <- data.frame(
  OVER60 = c(0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6),
  LEGA = c(0.19156, 0.17771, 0.17469, 0.16906, 0.15311, 0.1478, 0.13706, 0.13474, 0.12189, 0.11161, 0.10439),
  FI = c(0.098847, 0.09806, 0.094316, 0.08936, 0.086845, 0.078569, 0.078939, 0.073649, 0.070017, 0.06572, 0.061713),
  FDI = c(0.043526, 0.040015, 0.041801, 0.039802, 0.039929, 0.037976, 0.034966, 0.033668, 0.032354, 0.03087, 0.030109),
  PD = c(0.1025, 0.11352, 0.11926, 0.1305, 0.14749, 0.16189, 0.16711, 0.18154, 0.19802, 0.21165, 0.22475),
  M5S = c(0.29331, 0.2802, 0.26371, 0.24855, 0.23512, 0.22166, 0.21308, 0.19137, 0.17978, 0.17309, 0.15661),
  ALTRI = c(0.06289, 0.066934, 0.066441, 0.06991, 0.071053, 0.072943, 0.074253, 0.071846, 0.072655, 0.071971, 0.073959),
  NONVOTO = c(0.20737, 0.22356, 0.23978, 0.25282, 0.26646, 0.27917, 0.29459, 0.31319, 0.32529, 0.33508, 0.34846)
)

# Dati per l'intervallo di confidenza al 5%
data_ci_5 <- data.frame(
  OVER60 = c(0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6),
  LEGA = c(0.027673, 0.021517, 0.022148, 0.023839, 0.018788, 0.01626, 0.016192, 0.012334, 0.0091546, 0.009234, 0.0088499),
  FI = c(0.011662, 0.010982, 0.010964, 0.011008, 0.010051, 0.0074655, 0.0059809, 0.00466, 0.0048505, 0.0060029, 0.0041354),
  FDI = c(0.0014115, 0.0015466, 0.0011974, 0.0010899, 0.0015646, 0.0010823, 0.00099968, 0.00063181, 0.0006789, 0.00079862, 0.00043385),
  PD = c(0.010352, 0.012532, 0.016978, 0.018866, 0.025501, 0.030308, 0.0295, 0.035526, 0.036681, 0.04969, 0.052546),
  M5S = c(0.09468, 0.097894, 0.086567, 0.077367, 0.083285, 0.067436, 0.060387, 0.054834, 0.044064, 0.042285, 0.033636),
  ALTRI = c(0.004362, 0.0044573, 0.0048461, 0.0064827, 0.007561, 0.0060711, 0.007355, 0.0061471, 0.006201, 0.0064368, 0.0072324),
  NONVOTO = c(0.10236, 0.11562, 0.13088, 0.13892, 0.16247, 0.16018, 0.1766, 0.19048, 0.18568, 0.20177, 0.2038)
)

# Dati per l'intervallo di confidenza al 95%
data_ci_95 <- data.frame(
  OVER60 = c(0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6),
  LEGA = c(0.48634, 0.42906, 0.45352, 0.42768, 0.39199, 0.35804, 0.37959, 0.3712, 0.31931, 0.29419, 0.28066),
  FI = c(0.22855, 0.22576, 0.21301, 0.19796, 0.20309, 0.18717, 0.19537, 0.17562, 0.16908, 0.15336, 0.14982),
  FDI = c(0.11976, 0.11375, 0.11785, 0.11812, 0.11074, 0.1114, 0.10278, 0.10066, 0.10168, 0.091934, 0.092443),
  PD = c(0.26538, 0.26261, 0.29567, 0.30416, 0.33035, 0.37301, 0.38392, 0.417, 0.44112, 0.47432, 0.4872),
  M5S = c(0.61276, 0.58623, 0.53074, 0.51431, 0.50695, 0.46214, 0.43059, 0.38778, 0.38461, 0.36674, 0.31375),
  ALTRI = c(0.15097, 0.15507, 0.15393, 0.15992, 0.16791, 0.17521, 0.17277, 0.18092, 0.17166, 0.17352, 0.16667),
  NONVOTO = c(0.33381, 0.37113, 0.37739, 0.39585, 0.43491, 0.45317, 0.49312, 0.53372, 0.53149, 0.57583, 0.59066)
)


# Trasformare il dataframe in formato "long" per facilitare la creazione del grafico
data_long <- tidyr::gather(data, key = "Column", value = "Value", -OVER60)

data_long_ci05 <- tidyr::gather(data_ci_5, key = "Column", value = "ci05", -OVER60)

data_long_ci95 <- tidyr::gather(data_ci_95, key = "Column", value = "ci95", -OVER60)

data = cbind(data_long, data_long_ci05, data_long_ci95)

data_final = data[,c(1,2,3,6,9)]

# Creare il grafico a linee con facet per ogni colonna
ggplot(data_final, aes(x = OVER60, y = Value, group = Column)) +
  geom_line(aes(x = OVER60, y = Value, color = Column), size = 1) +
  geom_ribbon(aes(ymin = ci05, ymax = ci95, fill = Column), alpha = 0.3) +  # Aggiunge l'intervallo di confidenza come ribbon
  scale_y_continuous(breaks = seq(0, 0.8, by = 0.1))  + # Imposta etichette personalizzate sull'asse x
  scale_x_continuous(breaks = seq(0, 0.6, by = 0.1))  + # Imposta etichette personalizzate sull'asse x
  facet_wrap(~ Column, ncol = 4, scales = "fixed") +  # Creare i facet 
  theme_clean() +  # Tema del grafico
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.position = "none", 
        panel.spacing = unit(2, "lines")) +
  theme(strip.background = element_blank(),
        strip.placement = "outside") 

### 2022 ###

# Creazione del dataframe con i dati
data2022 <- data.frame(
  OVER60 = c(0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6),
  LEGA = c(0.067379, 0.063478, 0.062252, 0.06014, 0.059804, 0.05845, 0.049932, 0.050858, 0.048619, 0.046937, 0.045369),
  FI = c(0.056422, 0.052877, 0.046377, 0.052969, 0.046997, 0.046456, 0.040805, 0.040825, 0.037701, 0.036357, 0.035563),
  FDI = c(0.25276, 0.24564, 0.23842, 0.22284, 0.21488, 0.20413, 0.20288, 0.19663, 0.18176, 0.18397, 0.16372),
  PD = c(0.06223, 0.072005, 0.079848, 0.090032, 0.097781, 0.11107, 0.12641, 0.14117, 0.14678, 0.17005, 0.1876),
  M5S = c(0.076061, 0.076138, 0.079426, 0.079751, 0.070755, 0.072295, 0.072558, 0.066057, 0.062526, 0.062501, 0.0624),
  AZIV = c(0.033825, 0.038069, 0.036802, 0.038514, 0.038712, 0.04113, 0.037484, 0.037088, 0.038411, 0.038317, 0.039566),
  ALTRI = c(0.070887, 0.070711, 0.068831, 0.068894, 0.066541, 0.066284, 0.063121, 0.061637, 0.060316, 0.058206, 0.055852),
  NONVOTO = c(0.38044, 0.38108, 0.38804, 0.38686, 0.40453, 0.40019, 0.40682, 0.40573, 0.42389, 0.40366, 0.40993)
)

# Creazione del dataframe con i dati
data2022_ci5 <- data.frame(
  OVER60 = c(0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6),
  LEGA = c(0.0017376, 0.0018016, 0.0014774, 0.0016988, 0.0013283, 0.002357, 0.00095916, 0.00055682, 0.00046201, 0.00056238, 0.00060907),
  FI = c(0.001236, 0.00080934, 0.0010727, 0.0015173, 0.00065398, 0.00073908, 0.00068762, 0.00058588, 0.00033574, 0.00078728, 0.00024978),
  FDI = c(0.063129, 0.063342, 0.054995, 0.066771, 0.053173, 0.046079, 0.046214, 0.043784, 0.028641, 0.033335, 0.020905),
  PD = c(0.0018562, 0.0026695, 0.0034484, 0.0059983, 0.0077605, 0.010854, 0.014409, 0.016783, 0.016884, 0.027676, 0.034584),
  M5S = c(0.0020749, 0.0031986, 0.0031521, 0.0050258, 0.003175, 0.0032179, 0.0033051, 0.0024032, 0.002365, 0.0026001, 0.0016737),
  AZIV = c(0.00028285, 0.00032954, 0.00027614, 0.00058358, 0.00032335, 0.00041523, 0.00047563, 0.00028883, 0.00023865, 0.00047243, 0.00046172),
  ALTRI = c(0.003795, 0.0036913, 0.0030639, 0.0046226, 0.0034754, 0.0037503, 0.00279, 0.0026636, 0.0019587, 0.0022217, 0.0014153),
  NONVOTO = c(0.20771, 0.21477, 0.22193, 0.21888, 0.22332, 0.22655, 0.22736, 0.23346, 0.24013, 0.22978, 0.23392)
)

# Creazione del dataframe con i dati
data2022_ci95 <- data.frame(
  OVER60 = c(0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6),
  LEGA = c(0.17896, 0.17433, 0.16542, 0.1606, 0.17152, 0.15658, 0.14123, 0.13119, 0.13457, 0.12435, 0.12641),
  FI = c(0.14928, 0.14299, 0.12445, 0.13865, 0.12976, 0.1264, 0.1125, 0.11447, 0.10502, 0.099049, 0.10098),
  FDI = c(0.57518, 0.54144, 0.50427, 0.45604, 0.45721, 0.40939, 0.4463, 0.43512, 0.38226, 0.41258, 0.3459),
  PD = c(0.15413, 0.18032, 0.19189, 0.21697, 0.2432, 0.26868, 0.2991, 0.34116, 0.33821, 0.38595, 0.44225),
  M5S = c(0.20198, 0.19358, 0.19192, 0.20421, 0.18037, 0.18189, 0.19829, 0.16204, 0.15368, 0.16386, 0.15912),
  AZIV = c(0.10654, 0.10993, 0.10541, 0.10413, 0.11066, 0.113, 0.10652, 0.1077, 0.10961, 0.10843, 0.11287),
  ALTRI = c(0.16897, 0.17213, 0.15663, 0.15873, 0.15211, 0.15463, 0.15082, 0.13912, 0.14515, 0.14184, 0.13883),
  NONVOTO = c(0.73384, 0.71197, 0.71847, 0.73568, 0.72694, 0.76118, 0.73878, 0.71838, 0.79087, 0.72071, 0.73327)
)


# Trasformare il dataframe in formato "long" per facilitare la creazione del grafico
data_long2022 <- tidyr::gather(data2022, key = "Column", value = "Value", -OVER60)

data_long2022_ci05 <- tidyr::gather(data2022_ci5, key = "Column", value = "ci05", -OVER60)

data_long2022_ci95 <- tidyr::gather(data2022_ci95, key = "Column", value = "ci95", -OVER60)

data_2022 = cbind(data_long2022, data_long2022_ci05, data_long2022_ci95)

data2022_final = data_2022[,c(1,2,3,6,9)]

# Creare il grafico a linee con facet per ogni colonna
ggplot(data2022_final, aes(x = OVER60, y = Value, group = Column)) +
  geom_line(aes(x = OVER60, y = Value, color = Column), size = 1) +
  geom_ribbon(aes(ymin = ci05, ymax = ci95, fill = Column), alpha = 0.3) +  # Aggiunge l'intervallo di confidenza come ribbon
  scale_y_continuous(breaks = seq(0, 0.8, by = 0.1))  + # Imposta etichette personalizzate sull'asse x
  scale_x_continuous(breaks = seq(0, 0.6, by = 0.1))  + # Imposta etichette personalizzate sull'asse x
  facet_wrap(~ Column, ncol = 4, scales = "fixed") +  # Creare i facet 
  theme_clean() +  # Tema del grafico
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.position = "none", 
        panel.spacing = unit(2, "lines")) +
  theme(strip.background = element_blank(),
        strip.placement = "outside") 
